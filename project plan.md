### **项目计划书：代号 "FastGit" - 一款现代化的 macOS Git 客户端**

#### **1. 项目愿景与目标**

* **愿景**: 开发一款基于 SwiftUI 和 `libgit2` 的原生 macOS Git 客户端，提供闪电般的速度、直观的用户体验和强大的功能，让版本控制变得轻松愉快。
* **核心目标 (MVP - 最小可行产品)**: 实现一个功能完整的客户端，支持核心的本地和远程 Git 工作流，包括查看历史、状态管理、提交、分支操作和与远程仓库同步。

#### **2. 核心技术栈**

* **用户界面 (UI)**: SwiftUI
* **Git 核心引擎**: `libgit2` (通过 Swift 封装)
* **应用架构**: MVVM (Model-View-ViewModel)
* **异步处理**: Swift Concurrency (`async/await`)
* **包管理**: Swift Package Manager (SPM)

#### **3. 开发阶段与任务分解**

---

### **阶段 0: 基础架构与原型验证 (预计时间: 1-2周)**

**目标**: 搭建项目骨架，并验证 `libgit2` 与 SwiftUI 的可行性。本阶段结束时，应有一个能打开本地仓库并打印提交历史到控制台的程序。

* **任务 0.1: 项目初始化**
  * [ ] 创建一个新的 macOS SwiftUI 应用项目。
  * [ ] 初始化 Git 仓库，并建立基本的项目文件结构。

* **任务 0.2: Git 后端服务层集成**
  * [ ] 使用 SPM 引入一个 `libgit2` 的 Swift 封装库（例如，研究并选择一个社区维护的库，或者自己创建一个简单的封装）。
  * [ ] 创建一个 `GitService` 类，作为与 `libgit2` 交互的唯一入口。
  * [ ] 在 `GitService` 中实现第一个核心功能：`openRepository(at path: String)`。
  * [ ] 实现 `fetchCommitHistory()` 方法，该方法能返回一个 `Commit` 对象的数组 (自定义的 Swift 结构体)。

* **任务 0.3: 架构与 UI 原型**
  * [ ] 设计并创建核心的 Model 对象 (例如 `Repository`, `Commit`, `Branch`, `FileStatus`)。
  * [ ] 创建主 `MainViewModel`，负责管理当前打开的仓库状态。
  * [ ] 在 SwiftUI `ContentView` 中，添加一个 "Open Repository" 按钮。
  * [ ] 实现点击按钮后，调用 ViewModel，ViewModel 再调用 `GitService`，并将获取到的提交历史**打印到 Xcode 控制台**。

---

### **阶段 1: 核心只读功能 (预计时间: 2-3周)**

**目标**: 实现完整的仓库浏览和差异查看功能。本阶段结束时，用户应能像使用一个 "Git 查看器" 一样使用本应用。

* **任务 1.1: 仓库管理与导航**
  * [ ] 设计一个欢迎界面，用于打开或克隆仓库。
  * [ ] 实现一个侧边栏，用于展示和切换已打开的仓库。
  * [ ] 实现应用状态持久化（例如，记住上次打开的仓库）。

* **任务 1.2: 提交历史可视化**
  * [ ] 在主界面中，使用 SwiftUI 的 `List` 或 `Table` 来展示提交历史。
    * [ ] 每一行应显示 Commit 的 SHA (缩写)、提交信息、作者和日期。

* **任务 1.3: 差异 (Diff) 查看**
  * [ ] 创建一个新的视图区域，用于显示选中 Commit 的变更详情。
  * [ ] 实现 `GitService` 方法，获取指定 Commit 变更的文件列表。
  * [ ] 当用户点击一个文件时，调用 `GitService` 获取该文件的具体 Diff 内容。
  * [ ] 设计并实现一个优雅的 Diff 视图，用不同颜色（红/绿）展示代码的增删。

---

### **阶段 2: 核心写入工作流 (预计时间: 3-4周)**

**目标**: 实现 Git 最核心的 `status -> stage -> commit` 工作流。本阶段结束时，应用应成为一个功能性的本地 Git 客户端。

* **任务 2.1: 工作区状态视图**
  * [ ] 创建一个专门的 "Changes" 或 "Workspace" 视图。
  * [ ] 实现 `GitService` 方法以获取当前 `git status`（已暂存/未暂存/未跟踪的文件）。
  * [ ] 在视图中用两个列表分别展示 "Staged" 和 "Unstaged" 的文件。

* **任务 2.2: 暂存区交互**
  * [ ] 为每个文件变更添加暂存/取消暂存的按钮或复选框。
  * [ ] 实现 `stage(files: [String])` 和 `unstage(files: [String])` 的后端逻辑。
  * [ ] 当用户点击文件时，可以查看该文件在工作区与 `HEAD` 之间的差异。

* **任务 2.3: 提交功能**
  * [ ] 在 "Changes" 视图中添加一个提交信息输入框和 "Commit" 按钮。
  * [ ] 实现 `commit(message: String)` 的后端逻辑。
  * [ ] **关键**: 提交操作后，UI 必须自动刷新：Changes 视图变空，新的 Commit 出现在历史列表顶部。这需要完善 MVVM 的数据流。

---

### **阶段 3: 分支与合并 (预计时间: 3-4周)**

**目标**: 引入分支管理和历史图谱，处理多分支协作的复杂性。

* **任务 3.1: 分支管理**
  * [ ] 在侧边栏或专门的面板中，列出所有本地和远程分支。
  * [ ] 实现基础操作：切换分支 (Checkout)、创建新分支、删除分支。

* **任务 3.2: 提交历史图谱 (高难度)**
  * [ ] 升级提交历史列表，使其能够以图形方式展示分支的创建、合并和分叉。
  * [ ] 这可能需要使用 SwiftUI `Canvas` 或封装一个自定义的 AppKit 视图 (`NSViewRepresentable`) 来绘制复杂的图形。

* **任务 3.3: 合并与变基**
  * [ ] 实现拖拽分支或通过右键菜单来发起 `merge` 或 `rebase` 操作的 UI。
  * [ ] 在 `GitService` 中实现相应的后端逻辑。

* **任务 3.4: 冲突解决**
  * [ ] 当发生合并冲突时，UI 必须清晰地展示冲突状态和冲突文件列表。
  * [ ] (可选 MVP+) 实现一个简单的三路合并视图来帮助用户解决冲突。至少要能标记冲突并让用户在外部编辑器中解决。

---

### **阶段 4: 远程仓库协作 (预计时间: 2-3周)**

**目标**: 实现与远程仓库的交互，完成完整的协作闭环。

* **任务 4.1: 远程管理**
  * [ ] 实现添加、编辑和移除远程仓库 (`remote`) 的 UI。

* **任务 4.2: 核心远程操作**
  * [ ] 在 UI 中添加 `Fetch`, `Pull`, `Push` 按钮。
  * [ ] **关键**: 所有网络操作必须是异步的，并提供清晰的进度和状态反馈给用户。
  * [ ] 实现对不同 Push 行为的支持（例如 --force, --set-upstream）。

* **任务 4.3: 认证管理**
  * [ ] 实现对 SSH 密钥和 HTTPS (Personal Access Token) 的认证支持。
  * [ ] 安全地与 macOS 的 Keychain 集成，用于存储和检索凭据。

---

### **阶段 5: 打磨与发布 (预计时间: 2-4周)**

**目标**: 从一个“功能性工具”转变为一个“高质量产品”。

* **任务 5.1: 应用设置**
  * [ ] 创建一个偏好设置窗口（例如，配置用户信息、默认拉取行为等）。

* **任务 5.2: 用户体验优化**
  * [ ] 完善错误处理机制，提供用户友好的错误提示。
  * [ ] 增加键盘快捷键支持。
  * [ ] 性能分析与优化，特别是处理大型仓库时的响应速度。

* **任务 5.3: 应用发布准备**
  * [ ] 设计一个精美的应用图标。
  * [ ] 撰写帮助文档和“关于”窗口。
  * [ ] 进行全面的测试，邀请朋友进行 Beta 测试，并修复 Bug。
  * [ ] 准备上架 Mac App Store 或通过网站发布。
